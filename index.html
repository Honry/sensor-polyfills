
<script type="module">
import {
  Sensor,
  AbsoluteOrientationSensor,
  RelativeOrientationSensor,
  Gyroscope,
  Accelerometer,
  LinearAccelerationSensor,
  GravitySensor
} from './motion-sensors.js';

let log = console.log;
console.log = (message, ...rest) => {
  const div = document.querySelector('#console');
  let child = document.createElement('div');
  if (typeof(message) === 'object') {
    child.innerText = `${message.constructor.name}{${Object.getOwnPropertyNames(message)}}`;
  }
  else
    child.innerText = message;
  div.appendChild(child);
    
  log.call(console, message, ...rest);
}


let gyro = new Gyroscope({ frequency: 50 });

gyro.onerror = err => console.log(err);
gyro.onreading = (event) => {
  const sensor = event.target;

  const timestamp = document.querySelector('#timestamp');
  timestamp.innerHTML = `Timestamp: ${sensor.timestamp}`;

  const data = document.querySelector('#data');
  data.innerHTML = `[${sensor.alpha}, ${sensor.beta}, ${sensor.gamma}]`;
}
gyro.start();


/*
let sensor = new RelativeOrientationSensor();

sensor.onerror = err => console.log(err);

sensor.onreading = (event) => {
    const sensor = event.target;
    let mat = new Float32Array(16);
    sensor.populateMatrix(mat);
    const data = document.querySelector('#data');

    let str = "";
    for (let i = 0; i < 4; i++) {
      const a = mat[i * 4 + 0].toPrecision(3);
      const b = mat[i * 4 + 1].toPrecision(3);
      const c = mat[i * 4 + 2].toPrecision(3);
      const d = mat[i * 4 + 3].toPrecision(3);
      str += `[${a}, ${b}, ${c}, ${d}]<br>`;
    }
    data.innerHTML = `Matrix:<br>${str}`;

    const quat = document.querySelector('#quat');

    let q = sensor.quaternion;
    const a = q[0].toPrecision(3);
    const b = q[1].toPrecision(3);
    const c = q[2].toPrecision(3);
    const d = q[3].toPrecision(3); 
    quat.innerHTML = `Quaternion: [${a}, ${b}, ${c}, ${d}]`;

    const timestamp = document.querySelector('#timestamp');
    timestamp.innerHTML = `Timestamp: ${sensor.timestamp}`;
  }
  sensor.onactivate = _ => {
    console.log("activating");
    console.log("activated: " + sensor.activated);
  };
  console.log(sensor instanceof Sensor);
  console.log(sensor instanceof EventTarget);
  console.log(sensor);
  sensor.start();
*/
</script>

<body>
  <div id="data"></div>
  <div id="quat"></div>
  <div id="timestamp"></div>
  <div id="console"></div>
</body>
